#! /usr/bin/env python

import argparse
import json
import sys
import shutil
import os
from hera.simulations.hermesWorkflow import hermesWorkflow


def parser_prepare(arguments):

    hwf = hermesWorkflow(arguments.workflow)

    with open(arguments.configurationFile) as configurationFile:
        configuration = json.load(configurationFile)

    # 1. Prepare the geometry. Build the STL


    # 2. Make case parallel

    # 3. Make runfile.





if __name__=="__main__":

    parser = argparse.ArgumentParser()
    subparsers = parser.add_subparsers(help='sub-command help')

    parser_make  = subparsers.add_parser('make', help='Makes the relevant template')
    parser_prepare = subparsers.add_parser('prepare', help='Specialized the template according to specific configuration of the case')
    parser_build = subparsers.add_parser('executePipeline', help='executePipeline help')


    # Make - makes the case from requested template type.
    #        1. The template types should be datasource in the OF toolkit.
    #        2. Creates a default parameter file for the simulation runs.

    # Prepare - Specialized the workflow to the specific data of the run.
    #       1. Read the parameter file caseParameters.json and adjust the nodes of the template:
    #                - Geometry:
    #                       : Create (if necessary)
    #                       : Change the snappyHexMesh node : either add the parameters of the geometry
    #                         If geometry is empty, remove the node.
    #                - Other nodes:
    #                       : Write  the node in the appropriate .
    #       2.


    # Build - build all the cases from the parameter file and the template.
    #         Adds to the hera database if necessary.

    parser_prepare.add_argument('--workflow',dest="workflow",type=str,help='The workflow to alter (if exists)')
    parser_prepare.add_argument('--configurationFile', dest="configurationFile", type=str,default="caseConfiguration.json", help='The configuration file. Default caseConfiguration.json')
    parser_prepare.set_defaults(func=parser_prepare)


