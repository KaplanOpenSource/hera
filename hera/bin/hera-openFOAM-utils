#! /usr/bin/env python

import argparse
import json
import sys
import shutil
import os
from hera.simulations.openFoam.OFObjects import ofObjectHome


def createEmpty(args):
    if len(args.args) == 0 :
        raise ValueError("Must supply case directory")

    caseDir = args.args[0]
    fieldList = args.args[1:]
    print(f"Making case {caseDir} with fields {','.join(fieldList)}")

    # Make the case :
    os.makedirs(os.path.join(caseDir,"constant"),exist_ok=True)
    os.makedirs(os.path.join(caseDir, "system"),exist_ok=True)
    os.makedirs(os.path.join(caseDir, "0"),exist_ok=True)
    os.makedirs(os.path.join(caseDir, "0.parallel"), exist_ok=True)

    # Makes the empty fields
    for fieldName in fieldList:
        field = ofObjectHome().getField(fieldName)
        field.write(caseDirectory=caseDir,time=0)
        field.emptyParallelField(caseDirectory=caseDir,time=0)



def makeBlockmeshFromRegion(args):
    """
        Creates the blockmesh nodes from the region of the JSON

        The configuration file structure is:

            {
                "Regions" : {
                    "Height": 800
                    "Region": { "xmin":000,"xmax":000,"ymin":000,"ymax":000},
                    "STL" : {
                            "Buildings.stl" : "buildings",
                            "Topography.stl" : "topography"
                    }
                }
            }

    Parameters
    ----------
    args
    Returns
    -------

    """



if __name__=="__main__":

    parser = argparse.ArgumentParser()
    subparsers = parser.add_subparsers(help='sub-command help')

    parser_createEmpty  = subparsers.add_parser('createEmpty', help='Creates an empty case with empty fields')

    parser_createEmpty.add_argument('args',
                                    nargs='*',
                                    type=str,
                                    help='[Case directory] [list of field]')

    parser_createEmpty.set_defaults(func=createEmpty)


    parsed = parser.parse_args()
    parsed.func(parsed)
